{"version":3,"file":"component.js","sources":["../src/utils.js","../src/component.js"],"sourcesContent":["export const checkForAlpine = () => {\n    if (! window.Alpine) {\n        throw new Error('[Magic Helpers] Alpine is required for the magic helpers to function correctly.')\n    }\n}\n\nexport const saferEval = (expression, dataContext, additionalHelperVariables = {}) => {\n    if (typeof expression === 'function') {\n        return expression.call(dataContext)\n    }\n\n    return (new Function(['$data', ...Object.keys(additionalHelperVariables)], `var __alpine_result; with($data) { __alpine_result = ${expression} }; return __alpine_result`))(\n        dataContext, ...Object.values(additionalHelperVariables)\n    )\n}\n","import { checkForAlpine, saferEval } from './utils'\n\n// TODO: These can be refactored some to combine functionality\nconst AlpineComponentMagicMethod = {\n    start() {\n        checkForAlpine()\n\n        Alpine.addMagicProperty('parent', function ($el) {\n            if (typeof $el.$parent !== 'undefined') return $el.$parent\n\n            const parentComponent = $el.parentNode.closest('[x-data]')\n\n            if (!parentComponent) throw new Error('Parent component not found')\n\n            let data\n\n            if (parentComponent.__x) {\n                data = parentComponent.__x.getUnobservedData()\n            } else {\n                // Component isn't ready yet so lets try to get its initial state\n                data = saferEval(parentComponent.getAttribute('x-data'), parentComponent)\n            }\n\n            $el.$parent = allowTwoWayCommunication(data, parentComponent)\n\n            const parentObserver = new MutationObserver(mutations => {\n                for (let i = 0; i < mutations.length; i++) {\n                    const closestParentComponent = mutations[i].target.closest('[x-data]')\n\n                    if (closestParentComponent && !closestParentComponent.isSameNode(parentComponent)) continue\n\n                    if (!closestParentComponent.__x) {\n                        throw 'Error locating $parent data'\n                    }\n\n                    $el.$parent = allowTwoWayCommunication(closestParentComponent.__x.getUnobservedData(), parentComponent)\n                    $el.__x.updateElements($el)\n                }\n            })\n\n            parentObserver.observe(parentComponent, {\n                attributes: true,\n                childList: true,\n                characterData: true,\n                subtree: true,\n            })\n\n            return data\n        })\n\n        Alpine.addMagicProperty('component', function () {\n            return function (componentName) {\n                if (typeof this[componentName] !== 'undefined') return this[componentName]\n\n                const componentBeingObserved = document.querySelector(`[x-data][x-id=\"${componentName}\"], [x-data]#${componentName}`)\n\n                if (!componentBeingObserved) {\n                    throw 'Component not found'\n                }\n\n                // Set initial state\n                let data\n\n                if (componentBeingObserved.__x) {\n                    data = componentBeingObserved.__x.getUnobservedData()\n                } else {\n                    // Component isn't ready yet so lets try to get its initial state\n                    data = saferEval(componentBeingObserved.getAttribute('x-data'), componentBeingObserved)\n                }\n\n                this[componentName] = allowTwoWayCommunication(data, componentBeingObserved)\n\n                const observer = new MutationObserver(mutations => {\n                    for (let i = 0; i < mutations.length; i++) {\n                        const closestParentComponent = mutations[i].target.closest('[x-data]')\n\n                        if ((closestParentComponent && closestParentComponent.isSameNode(this.$el))) continue\n\n                        if (!closestParentComponent.__x) {\n                            throw 'Error locating $component data'\n                        }\n\n                        this[componentName] = allowTwoWayCommunication(closestParentComponent.__x.getUnobservedData(), componentBeingObserved)\n                    }\n                })\n\n                observer.observe(componentBeingObserved, {\n                    attributes: true,\n                    childList: true,\n                    characterData: true,\n                    subtree: true,\n                })\n\n                return this[componentName]\n            }\n        })\n    }\n}\n\nconst allowTwoWayCommunication = (data, observedComponent) => {\n    return new Proxy(data, {\n        set(target, prop, value) {\n            if (!observedComponent.__x) {\n                throw new Error('Failed to communicate with observed component')\n            }\n\n            observedComponent.__x.$data[prop] = value\n\n            return true\n        }\n    })\n}\n\nconst alpine = window.deferLoadingAlpine || ((alpine) => alpine())\n\nwindow.deferLoadingAlpine = function (callback) {\n    alpine(callback)\n\n    AlpineComponentMagicMethod.start()\n}\n\nexport default AlpineComponentMagicMethod\n"],"names":["saferEval","expression","dataContext","additionalHelperVariables","call","Function","Object","keys","values","AlpineComponentMagicMethod","start","window","Alpine","Error","checkForAlpine","addMagicProperty","$el","$parent","data","parentComponent","parentNode","closest","__x","getUnobservedData","getAttribute","allowTwoWayCommunication","MutationObserver","mutations","i","length","closestParentComponent","target","isSameNode","updateElements","observe","attributes","childList","characterData","subtree","componentName","this","componentBeingObserved","document","querySelector","_this","observedComponent","Proxy","set","prop","value","$data","alpine","deferLoadingAlpine","callback"],"mappings":"yOAAO,IAMMA,EAAY,SAACC,EAAYC,EAAaC,mBAAAA,IAAAA,EAA4B,IACjD,mBAAfF,EACAA,EAAWG,KAAKF,GAGnB,IAAIG,UAAU,gBAAYC,OAAOC,KAAKJ,4DAAqFF,8CAC/HC,UAAgBI,OAAOE,OAAOL,MCThCM,EAA6B,CAC/BC,kBDJ0B,eACpBC,OAAOC,aACH,IAAIC,MAAM,mFCGhBC,GAEAF,OAAOG,iBAAiB,SAAU,SAAUC,WACb,IAAhBA,EAAIC,QAAyB,OAAOD,EAAIC,YAM/CC,EAJEC,EAAkBH,EAAII,WAAWC,QAAQ,gBAE1CF,EAAiB,MAAM,IAAIN,MAAM,qCAKlCK,EADAC,EAAgBG,IACTH,EAAgBG,IAAIC,oBAGpBvB,EAAUmB,EAAgBK,aAAa,UAAWL,GAG7DH,EAAIC,QAAUQ,EAAyBP,EAAMC,GAEtB,IAAIO,iBAAiB,SAAAC,OACnC,IAAIC,EAAI,EAAGA,EAAID,EAAUE,OAAQD,IAAK,KACjCE,EAAyBH,EAAUC,GAAGG,OAAOV,QAAQ,gBAEvDS,GAA2BA,EAAuBE,WAAWb,QAE5DW,EAAuBR,SAClB,8BAGVN,EAAIC,QAAUQ,EAAyBK,EAAuBR,IAAIC,oBAAqBJ,GACvFH,EAAIM,IAAIW,eAAejB,OAIhBkB,QAAQf,EAAiB,CACpCgB,YAAY,EACZC,WAAW,EACXC,eAAe,EACfC,SAAS,IAGNpB,IAGXN,OAAOG,iBAAiB,YAAa,kBAC1B,SAAUwB,sBACsB,IAAxBC,KAAKD,GAAgC,OAAOC,KAAKD,OASxDrB,EAPEuB,EAAyBC,SAASC,gCAAgCJ,kBAA6BA,OAEhGE,OACK,6BAONvB,EADAuB,EAAuBnB,IAChBmB,EAAuBnB,IAAIC,oBAG3BvB,EAAUyC,EAAuBjB,aAAa,UAAWiB,QAG/DF,GAAiBd,EAAyBP,EAAMuB,GAEpC,IAAIf,iBAAiB,SAAAC,OAC7B,IAAIC,EAAI,EAAGA,EAAID,EAAUE,OAAQD,IAAK,KACjCE,EAAyBH,EAAUC,GAAGG,OAAOV,QAAQ,gBAEtDS,IAA0BA,EAAuBE,WAAWY,EAAK5B,UAEjEc,EAAuBR,SAClB,iCAGVsB,EAAKL,GAAiBd,EAAyBK,EAAuBR,IAAIC,oBAAqBkB,OAI9FP,QAAQO,EAAwB,CACrCN,YAAY,EACZC,WAAW,EACXC,eAAe,EACfC,SAAS,IAGNE,KAAKD,QAMtBd,EAA2B,SAACP,EAAM2B,UAC7B,IAAIC,MAAM5B,EAAM,CACnB6B,aAAIhB,EAAQiB,EAAMC,OACTJ,EAAkBvB,UACb,IAAIT,MAAM,wDAGpBgC,EAAkBvB,IAAI4B,MAAMF,GAAQC,GAE7B,MAKbE,EAASxC,OAAOyC,oBAAuB,SAACD,UAAWA,YAEzDxC,OAAOyC,mBAAqB,SAAUC,GAClCF,EAAOE,GAEP5C,EAA2BC"}